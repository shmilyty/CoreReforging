# 钢之魂：核心重构 (Steel Soul: Core Reconstruction)

<div align="center">

![Version](https://img.shields.io/badge/version-2.0-blue.svg)
![C++](https://img.shields.io/badge/C++-17-00599C.svg?logo=c%2B%2B)
![Platform](https://img.shields.io/badge/platform-Windows-lightgrey.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)

*一个基于 C++ 的末日废土机甲冒险 RPG 游戏*

[功能特性](#-功能特性) • [快速开始](#-快速开始) • [游戏玩法](#-游戏玩法) • [系统说明](#-系统说明) • [开发](#-开发)

</div>

---

## 📖 简介

**钢之魂：核心重构** 是一款文字冒险 RPG 游戏，玩家扮演废土世界中的机甲驾驶员，通过探索、战斗、收集装备来提升实力。游戏采用回合制战斗系统，融合了装备管理、升级强化、商店交易、装备合并等多种玩法元素。

### 🌟 核心特色

- **丰富的装备系统**：50+ 种武器和 4 种装甲，涵盖 4 个稀有度等级
- **策略性战斗**：回合制战斗，考验装备搭配和资源管理
- **装备成长**：装备升级系统，最高 3 级，属性提升 20%/级
- **装备合并**：合并同势力同类型装备，获得更高稀有度装备
- **动态商店**：随机刷新商品，支持手动刷新
- **冒险模式**：无尽挑战，难度递增，篝火休整点
- **多存档系统**：3 个独立存档槽位，自动恢复损坏存档

---

## 🎮 功能特性

### 装备系统
- **武器属性**：攻击力、暴击率、攻击速度、重量
- **装甲属性**：最大 HP、完美闪避率、承重量
- **稀有度分级**：损坏（白）、普通（绿）、军用（红）、传奇（黄）
- **势力系统**：共和国、帝国、废土三大势力

### 战斗系统
- **回合制战斗**：玩家与随机怪物进行回合制对战
- **暴击机制**：武器暴击时造成 2 倍伤害
- **闪避机制**：装甲提供完美闪避概率（承重 > 60% 时失效）
- **攻击速度**：不同武器有不同的攻击间隔

### 升级系统
- **装备等级**：1-3 级，每级提升 20% 属性（重量除外）
- **升级成本**：10 × 稀有度等级 × 当前等级的 EXP
- **升级失败**：军用/传奇装备升级有 40% 失败率

### 商店系统
- **随机商品**：每次刷新 3 件装备，无重复
- **稀有度概率**：损坏 50%、普通 30%、军用 15%、传奇 5%
- **手动刷新**：花费 EXP 刷新，费用递增（50 → 100 → 200...）
- **自动刷新**：冒险结束后基地商店刷新，篝火商店下次访问刷新

### 装备合并
- **合并规则**：
  - 同势力 + 同类型（武器/装甲）
  - 不能是传奇装备
  - 不能合并已装备的装备
- **合并结果**：稀有度 = max(稀有度1, 稀有度2) + 1，等级重置为 1

### 冒险系统
- **随机遭遇**：从 7 种怪物中随机遭遇
- **篝火机制**：每击败 3 个敌人到达篝火，可免费恢复 HP、升级装备、更换装备、访问商店
- **难度递增**：每过一个篝火，后续敌人攻击/HP +5%，EXP 掉落 +10%
- **修复服务**：花费 EXP 恢复 HP（1 EXP = 1 HP）
- **冒险统计**：记录总 EXP 获得、总 EXP 消耗、武器伤害统计

### 存档系统
- **3 个存档槽位**：独立保存玩家进度
- **自动恢复**：检测并修复损坏的存档文件
- **存档内容**：玩家名称、EXP、装备背包、装备配置、商店状态

---

## 🚀 快速开始

### 环境要求

- **编译器**：支持 C++17 的编译器（如 g++ 7.0+、MSVC 2017+、Clang 5.0+）
- **操作系统**：Windows（使用了 `system("cls")` 和 `Sleep` 等 Windows API）
- **依赖库**：[nlohmann/json](https://github.com/nlohmann/json)（已包含在 `json.hpp`）

### 编译

使用 g++ 编译：

```bash
g++ -std=c++17 main.cpp GameCore.cpp -o game.exe
```

或使用其他编译器：

```bash
# MSVC
cl /std:c++17 /EHsc main.cpp GameCore.cpp /Fe:game.exe

# Clang
clang++ -std=c++17 main.cpp GameCore.cpp -o game.exe
```

### 运行

```bash
./game.exe
```

首次运行会自动创建 `saves` 文件夹和 3 个空存档槽位。

---

## 🎯 游戏玩法

### 开始游戏

1. 运行游戏后，选择一个存档槽位（1-3）
2. 如果是新存档，输入驾驶员名称
3. 新玩家会获得初始装备：
   - 武器：制式步枪（普通）
   - 装甲：皮革背心（普通）

### 主菜单选项

```
[1] 查看机库 (Inventory)   - 查看所有装备
[2] 装备管理 (Equip)       - 装备/卸下武器和装甲
[3] 装备升级 (Upgrade)     - 花费 EXP 升级装备
[4] 出发冒险 (Adventure)   - 开始冒险，击败怪物获取 EXP
[5] 访问商店 (Shop)        - 购买装备
[6] 装备合并 (Merge)       - 合并两件装备获得更高稀有度
[7] 手动存档 (Save)        - 保存当前进度
[0] 退出系统 (Exit)        - 退出游戏
```

### 装备管理技巧

- **承重机制**：武器总重量不能超过装甲承重
- **闪避惩罚**：武器总重量 > 装甲承重 60% 时，闪避率归零
- **多武器策略**：可装备多把武器，轮流攻击
- **势力搭配**：合并装备时需要同势力

### 战斗策略

- **暴击流**：装备高暴击率武器（如加特林机枪 100% 暴击）
- **速攻流**：装备攻击速度快的武器（1 回合/次）
- **重炮流**：装备高攻击力武器（如传奇狙击炮 300 攻击）
- **闪避流**：保持武器重量 < 装甲承重 60%，利用闪避率

### 资源管理

- **EXP 获取**：击败怪物获得，冒险结束时结算
- **EXP 用途**：
  - 升级装备
  - 购买商店装备
  - 手动刷新商店
  - 修复 HP（冒险中）

---

## 📚 系统说明

### 装备稀有度与价格

| 稀有度 | 颜色 | 商店价格 | 升级成本/级 | 升级成功率 |
|--------|------|----------|-------------|------------|
| 损坏   | 白色 | 500 EXP  | 10 EXP      | 100%       |
| 普通   | 绿色 | 1000 EXP | 20 EXP      | 100%       |
| 军用   | 红色 | 1500 EXP | 30 EXP      | 60%        |
| 传奇   | 黄色 | 2000 EXP | 40 EXP      | 60%        |

### 怪物列表

| ID   | 名称         | HP  | 攻击 | EXP |
|------|--------------|-----|------|-----|
| 1001 | 废铁史莱姆   | 50  | 5    | 10  |
| 1002 | 废土游荡者   | 100 | 15   | 25  |
| 1003 | 机械蜘蛛     | 150 | 20   | 40  |
| 1004 | 废铁守卫     | 200 | 25   | 60  |
| 1005 | 腐蚀机器人   | 300 | 35   | 100 |
| 1006 | 狂暴挖掘机   | 500 | 50   | 150 |
| 1007 | 泰坦哨兵     | 800 | 70   | 250 |

### 装备升级属性加成

装备升级后，除重量外的所有属性都会获得加成：

- **Lv.1 → Lv.2**：属性 × 1.2（+20%）
- **Lv.2 → Lv.3**：属性 × 1.4（+40% 相对 Lv.1）

**示例**：制式步枪（普通）
- Lv.1：攻击 50，暴击率 10%，攻速 2，重量 3
- Lv.2：攻击 60，暴击率 12%，攻速 2，重量 3
- Lv.3：攻击 70，暴击率 14%，攻速 2，重量 3

### 商店刷新机制

**基地商店**：
- 冒险结束后自动刷新
- 可花费 EXP 手动刷新（50 → 100 → 200...）

**篝火商店**：
- 下次访问篝火时刷新
- 可花费 EXP 手动刷新（50 → 100 → 200...）

**刷新费用重置**：
- 自动刷新后，手动刷新费用重置为 50 EXP

---

## 🛠️ 开发

### 项目结构

```
.
├── main.cpp              # 主程序入口和游戏循环
├── GameCore.h            # 核心数据结构（Equipment, Weapon, Armor）
├── GameCore.cpp          # 核心数据结构实现
├── DataLoader.h          # JSON 数据加载器
├── SaveManager.h         # 存档管理系统
├── Adventure.h           # 冒险系统（战斗、篝火）
├── Shop.h                # 商店系统
├── gamedata.json         # 游戏数据（装备、怪物）
├── json.hpp              # nlohmann/json 库
└── saves/                # 存档文件夹
    ├── save_slot_1.json  # 存档槽 1
    ├── save_slot_2.json  # 存档槽 2
    ├── save_slot_3.json  # 存档槽 3
    └── shop_slot_*.json  # 商店状态
```

### 核心类设计

```cpp
// 装备基类
class Equipment {
protected:
    int tid;                // 模板 ID
    string name;            // 名称
    Rarity rarity;          // 稀有度
    string faction;         // 势力
    int level;              // 等级 (1-3)
public:
    virtual Equipment* clone(string newName, int newLv) = 0;
    virtual bool levelUp() = 0;
    virtual int getUpgradeCost() const = 0;
    // ...
};

// 武器类
class Weapon : public Equipment {
private:
    int atk;                // 攻击力
    int crit_rate;          // 暴击率 (%)
    int atk_speed;          // 攻击速度 (回合/次)
    int weight;             // 重量
    // ...
};

// 装甲类
class Armor : public Equipment {
private:
    int max_hp;             // 最大 HP
    int dodge_rate;         // 闪避率 (%)
    int capacity;           // 承重量
    // ...
};
```

### 添加新装备

在 `gamedata.json` 中添加：

```json
{
  "id": 151,
  "type": "weapon",
  "name": "新武器名称",
  "rarity": "MILITARY",
  "faction": "共和国",
  "atk": 150,
  "crit_rate": 20,
  "atk_speed": 2,
  "weight": 7
}
```

### 添加新怪物

在 `gamedata.json` 的 `monsters` 数组中添加：

```json
{
  "id": 1008,
  "name": "新怪物名称",
  "hp": 1000,
  "atk": 80,
  "exp": 300
}
```

---

## 📝 详细文档

项目包含以下详细文档：

- [功能说明.md](功能说明.md) - 装备系统详细说明
- [升级系统说明.md](升级系统说明.md) - 装备升级机制
- [升级失败机制说明.md](升级失败机制说明.md) - 升级失败概率
- [存档系统说明.md](存档系统说明.md) - 存档管理
- [存档恢复系统说明.md](存档恢复系统说明.md) - 存档恢复机制
- [冒险系统说明.md](冒险系统说明.md) - 冒险模式详解
- [商店系统说明.md](商店系统说明.md) - 商店系统
- [商店系统改进总结.md](商店系统改进总结.md) - 商店改进
- [装备合并系统说明.md](装备合并系统说明.md) - 装备合并
- [编译说明.md](编译说明.md) - 编译指南

---

## 🎨 游戏截图示例

```
===============================
   钢之魂：核心重构 (Ver 2.0)
===============================
驾驶员: 玩家名称
当前 EXP: 1500
-------------------------------
[1] 查看机库 (Inventory)
[2] 装备管理 (Equip)
[3] 装备升级 (Upgrade)
[4] 出发冒险 (Adventure)
[5] 访问商店 (Shop)
[6] 装备合并 (Merge)
[7] 手动存档 (Save)
[0] 退出系统 (Exit)
-------------------------------
>>> 请输入指令:
```

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

### 贡献指南

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

---

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

---

## 🙏 致谢

- [nlohmann/json](https://github.com/nlohmann/json) - JSON 解析库
- 所有测试者和贡献者

---

## 📮 联系方式

如有问题或建议，欢迎通过以下方式联系：

- 提交 [Issue](../../issues)
- 发起 [Discussion](../../discussions)

---

<div align="center">

**享受游戏！在废土中生存下去！** 🎮⚔️🛡️

Made with ❤️ by Steel Soul Team

</div>

