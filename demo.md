没问题！我们在写代码之前，确实需要一份详尽的**企划书（Game Design Document）**。这份文档不仅能帮你们理清思路，还能直接作为你们**期末报告的一部分**（教授通常非常看重项目文档）。

这份企划是基于**无图形库（纯控制台）**环境设计的，我们将通过复杂的系统深度来弥补画面的不足。

------

# 项目企划书：《钢之魂：核心重构》(Steel Soul: Core Reforging)

## 1. 项目概述 (Overview)

- **类型：** 文本策略 / 养成 / RPG
- **核心玩法：** 探索废土 -> 收集零件 -> 组装/合成机甲 -> 挑战更强BOSS。
- **开发语言：** C++ (C++11 或更高)
- **运行环境：** Windows/Linux 控制台 (Console)
- **核心目标：** 展示面向对象编程的封装、继承、多态，以及文件流操作和内存管理。

------

## 2. 游戏流程与菜单架构 (Game Flow & Menu)

游戏采用**层级菜单**设计。启动游戏后进入主菜单，加载存档后进入“基地（Hub）”界面。

### A. 主菜单 (Main Menu)

1. **新游戏 (New Game):** 输入玩家ID，初始化一台破旧的基础机甲（只有基础芯片和生锈铁拳）。
2. **加载存档 (Load Game):** 读取 `save.json`，恢复之前的进度。
3. **操作说明 (Help):** 简单的文本教程。
4. **退出 (Exit):** 结束程序。

### B. 基地界面 (The Hub - 游戏主循环)

这是玩家待机的地方，屏幕上方常驻显示机甲当前状态简报（HP、战斗力评分）。屏幕下方是功能选项：

#### [1] 机库 (Hangar) —— *核心养成模块*

- **查看机甲 (Inspect):** 显示详细属性面板（攻击、防御、重量、暴击率）。
- **更换装备 (Equip):**
  - 选择部位：[头部] / [核心&躯干] / [武器] / [腿部]。
  - 列出背包中该部位的所有装备，对比属性差异，确认更换。
  - 每个装备都有几个参数：名称，稀有度，来自哪个势力。
    - 每个装备的名称都是一个形容词+一个名词，比如 寒冰矛，破旧铁拳
    - 稀有度：破损的（白色字体显示），标准的（绿色字体显示），军用的（紫色字体显示），传说中的（黄色字体显示）
    - 目前有三个势力：帝国，共和国，经济体，不同的势力的装备各有优势。
  - *OOP考点：多态（不同零件计算属性的方式不同）。*
- **卸下装备 (Unequip):** 将装备放回背包。
- **所有的装备的属性和数值从 `gear.json` 读取**

#### [2] 改装车间 (Workshop) —— *进化与合成模块*

- **装备合成 (Merge/Evolve):**
  - 这是游戏的“进化”核心。
  - 重载加法运算符，从而可以花费一定货币合成两个装备
  - 两个装备如果可以合成，当且仅当是同一个部位的装备，且来自同一个势力。
  - 选择合成后，所有数值属性和稀有度属性会成为两个武器的较大值，名称会从两个装备中随机一个，选择它的形容词，然后取另外一个装备的名词。
  - *OOP考点：运算符重载 (Operator Overloading)。*
- 装备升级：花费经验提高数值，二级增加原本数值的 $20\%$，三级 $40\%$，四级 $60\%$，五级 $80\%$
- **废品回收 (Recycle):** 销毁不需要的装备，换取“金币”和经验。

#### [3] 废土探索 (Expedition) —— *战斗模块*

- **选择区域:**
  - 区域1：钢铁垃圾场 (新手区)
  - 区域2：失落都市 (进阶掉落)
  - 区域3：核心实验室 (BOSS战)
- **战斗循环:** 遭遇敌人 -> 回合制战斗 -> 结算（获得经验、金币、随机掉落）。

#### [4] 黑市 (Black Market) —— *交易模块*

- **每日特惠:** 随机刷新3个高品质装备。
- **修理机甲:** 花费金币回满HP。

#### [5] 系统 (System)

- **保存进度 (Save):** 将当前对象状态写入文件。
- **返回主菜单 (Quit to Title)。**

------

## 3. 详细功能与OOP设计结合点

为了应付大学作业，每一个功能都要对应一个技术点。

### 3.1 机甲属性与计算 (Stats System)

机甲不仅仅是血量和攻击，为了增加策略性，我们设计以下属性：

- **Weight (重量) vs Load (负载):**
  - 所有装备都有重量。
  - [核心] 提供负载上限。如果 `Total Weight > Max Load`，机甲无法出战，如果大于maxload/2，机甲闪避成功概率强制为0。
  - *实现：在 `Mech` 类中封装 `bool checkOverload()` 函数。*
- **Energy (能量):**
  - 强力武器（如激光炮）攻击消耗能量。
  - [核心] 每回合恢复一定能量。
  - *实现：战斗循环中的资源管理逻辑。*

### 3.2 战斗系统 (Battle System)

采用**文字描述的回合制**（类似早期的MUD游戏）。

- **流程:**

  Plaintext

  ```
  [第 1 回合]
  你使用了 <等离子光剑> 攻击!
  判定：命中! (命中率 85%)
  敌人 <废铁守卫> 受到 120 点伤害!
  ------------------------------
  敌人 <废铁守卫> 启动了 <重机枪>!
  警告：护盾受损! 受到 45 点伤害!
  ```

- **特殊机制 (多态的体现):**

  - 闪避

### 3.3 随机生成系统 (Factory Pattern)

- 不要手动把所有零件写在代码里。
- 设计一个 `PartFactory` 类，拥有方法 `generateLoot(int level)`。
- 根据 level 生成前缀（例如：`"破损的"`, `"标准的"`, `"军用的"`, `"传说中的"`），前缀决定属性倍率。

------

## 4. 界面展示设计 (UI Layout)

既然是控制台，就要利用好**格式化输出**。建议使用 `iomanip` 库中的 `setw` (设置宽度) 来对齐表格。

**机库界面示例设计：**

Plaintext

```
============================================================
| 机体: 暴风赤红 (Mk-II)        | 驾驶员: User01           |
============================================================
| 部位 | 装备名称             | 等级 | 属性加成            |
|------+----------------------+------+---------------------|
| [头] | 战术目镜 Alpha       |  B   | 命中+15, 暴击+5%    |
| [身] | 反应堆装甲           |  A   | HP+800, 负载+50     |
| [手] | 链锯剑               |  C   | 攻击+120            |
| [腿] | 履带底盘             |  C   | 速度-5, 负重+200    |
============================================================
| 综合战力评分: 1450           | 状态: 良好                |
============================================================
[1] 更换装备   [2] 强化装备   [3] 返回
请选择操作: _
```

------

## 5. 项目分工建议 (Role Assignment)

假设你们小组有3人，这是最高效的分工方式：

### 成员 A (组长/架构师)

- **负责：** 类结构设计、主循环、战斗引擎。
- **具体任务：**
  - 编写 `main.cpp` 的主菜单循环。
  - 定义 `Component` 基类和 `Mech` 类的头文件。
  - 编写战斗逻辑（计算伤害、判定胜负）。
- **难点：** 确保多态能正常工作，指针管理不泄露内存。

### 成员 B (数据与内容)

- **负责：** 零件子类实现、工厂生成、文件存取。
- **具体任务：**
  - 实现 `Weapon`, `Armor`, `Engine` 具体类。
  - 编写 `PartFactory`，设计随机掉落算法。
  - 实现 Save/Load 功能（文件读写）。
- **难点：** 存档时如何保存指针指向的对象？（需要设计序列化格式）。

### 成员 C (UI与交互)

- **负责：** 界面绘制、合成系统、商店逻辑。
- **具体任务：**
  - 封装一个 `Display` 类，专门负责 `cout` 各种漂亮的表格和边框。
  - 编写“合成/强化”的具体算法。
  - 设计商店买卖逻辑。
- **难点：** 让控制台界面看起来整齐，处理用户的非法输入（比如输入字母导致程序崩溃）。

------

