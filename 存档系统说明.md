# 钢之魂 Ver 0.3 - 存档系统说明

## 📁 存档文件夹结构

```
2025.12.28/
├── game.exe           # 游戏主程序
├── gamedata.json      # 游戏数据库（装备和怪物模板）
├── enemy.json         # 怪物数据
├── saves/             # 存档文件夹 ⭐新增
│   ├── save_slot_1.json
│   ├── save_slot_2.json
│   └── save_slot_3.json
└── ...
```

## ✨ 新功能

### 1. 独立存档文件夹
- 所有存档文件现在保存在 `saves/` 文件夹中
- 便于管理和备份
- 与游戏主文件分离，更清晰

### 2. 自动初始化
- 游戏启动时自动检查并创建 `saves/` 文件夹
- 自动初始化3个空存档槽位
- 如果存档文件不存在，自动创建空存档

### 3. 存档信息显示
启动游戏时会显示所有存档槽位的信息：

```
=== 存档槽位 ===
[1] 存档 1 - 玩家A (EXP: 100, 装备: 5件)
[2] 存档 2 - 空槽位
[3] 存档 3 - 玩家C (EXP: 500, 装备: 10件)
===================

请选择存档槽位 (1-3):
```

## 📄 存档文件格式

### 空存档
```json
{
    "player_name": "",
    "exp": 0,
    "inventory": []
}
```

### 有数据的存档
```json
{
    "player_name": "玩家A",
    "exp": 100,
    "inventory": [
        {
            "tid": 101,
            "lv": 2,
            "rar": 1
        },
        {
            "tid": 201,
            "lv": 1,
            "rar": 1
        }
    ]
}
```

### 字段说明
- `player_name`: 玩家名字（空字符串表示空槽位）
- `exp`: 当前经验值
- `inventory`: 装备列表
  - `tid`: 装备模板ID（对应 gamedata.json 中的 id）
  - `lv`: 装备等级（1-3）
  - `rar`: 稀有度（0=损坏, 1=普通, 2=军用, 3=传奇）

## 🎮 使用方法

### 创建新存档
1. 启动游戏
2. 选择空槽位（显示为"空槽位"）
3. 输入玩家名字
4. 自动获得新手礼包（5件装备）
5. 开始游戏

### 加载已有存档
1. 启动游戏
2. 查看存档信息（显示玩家名、EXP、装备数量）
3. 选择要加载的存档槽位
4. 自动加载玩家数据
5. 继续游戏

### 覆盖存档
- 选择已有存档的槽位
- 输入新的玩家名字
- 会覆盖原有存档

## 💾 备份和恢复

### 备份存档
只需复制整个 `saves/` 文件夹即可：
```bash
# Windows
xcopy saves saves_backup /E /I

# 或者直接复制文件夹
```

### 恢复存档
将备份的 `saves/` 文件夹复制回游戏目录即可。

### 单个存档备份
```bash
# 备份存档1
copy saves\save_slot_1.json saves\save_slot_1_backup.json

# 恢复存档1
copy saves\save_slot_1_backup.json saves\save_slot_1.json
```

## 🔧 技术细节

### 存档路径
- 旧版本: `./save_slot_X.json`（根目录）
- 新版本: `./saves/save_slot_X.json`（saves文件夹）

### 初始化流程
1. 游戏启动时调用 `SaveManager::initializeSaveSlots()`
2. 检查 `saves/` 文件夹是否存在，不存在则创建
3. 检查每个存档文件是否存在
4. 不存在的存档文件会被创建为空存档

### 存档检测
- 通过 `isSlotEmpty()` 检查存档是否为空
- 判断依据：`player_name` 是否为空字符串

### 存档显示
- `showSaveSlots()` 显示所有存档信息
- 读取每个存档文件的基本信息
- 显示玩家名、EXP、装备数量

## 📊 存档管理功能

### 已实现
- ✅ 自动创建存档文件夹
- ✅ 自动初始化3个槽位
- ✅ 显示存档信息（玩家名、EXP、装备数）
- ✅ 区分空槽位和已使用槽位
- ✅ 自动保存到 saves 文件夹
- ✅ 自动从 saves 文件夹加载

### 可扩展功能
- ⏳ 删除存档功能
- ⏳ 存档时间戳显示
- ⏳ 存档截图/预览
- ⏳ 云存档同步
- ⏳ 存档导入/导出

## 🎯 最佳实践

### 定期备份
建议定期备份 `saves/` 文件夹，特别是：
- 完成重要任务后
- 获得稀有装备后
- 升级到满级后
- 长时间游戏后

### 多存档策略
- 存档1：主要进度
- 存档2：实验/测试用
- 存档3：备用/新角色

### 存档命名
虽然游戏内只显示玩家名，但可以通过玩家名来区分不同的游戏风格：
- "速攻流"
- "重装流"
- "平衡流"

## 🐛 故障排除

### 存档丢失
1. 检查 `saves/` 文件夹是否存在
2. 检查存档文件是否存在
3. 检查文件权限
4. 从备份恢复

### 存档损坏
1. 打开存档文件检查JSON格式
2. 使用JSON验证工具检查
3. 从备份恢复
4. 创建新存档

### 无法保存
1. 检查磁盘空间
2. 检查文件夹权限
3. 检查文件是否被占用
4. 以管理员身份运行游戏

## 📝 版本更新

### Ver 0.3
- ✅ 新增 `saves/` 文件夹
- ✅ 自动初始化存档槽位
- ✅ 存档信息显示功能
- ✅ 空槽位检测
- ✅ 改进的存档界面

### 兼容性
- 旧版本的存档文件（根目录的 `save_slot_X.json`）需要手动移动到 `saves/` 文件夹
- 或者重新开始游戏创建新存档

